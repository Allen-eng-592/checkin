<script>
  const LIFF_ID = "2008627576-zOEQAV47";
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxqUil4R7C8HxzAXAgdw88eA2bserMAOxywoZtYhlg4_-Dioi44B6OGNaWo9jGv5MYG2A/exec";

  async function main() {
    const statusEl = document.getElementById("statusMsg");
    statusEl.innerText = "正在初始化 LIFF...";

    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) { liff.login(); return; }

    const profile = await liff.getProfile();

    document.getElementById("avatar").src = profile.pictureUrl;
    document.getElementById("username").innerText = profile.displayName;    document.getElementById("profileArea").style.display = 

       co st  = = docume.t.getElementById("btnCheckin;
      b.n.disabl = = fal;
      b.n.oncli = =  => > sendCheckin(profil;

      status.l.innerTe = = "請按下「開始打卡」;
   

    functi n askName(defaultNam )
      // 讓使用者輸入姓名（預設帶入 LINE 顯示名
      con t inp = = prompt("請輸入姓名（必填, , defaultNa || | ";
       f!(!inpu ) retu n nu;
      con t na = = inp.t.trim;
       f!(!nam ) retu n nu;
      retu n na;
   

    functi n sendCheckin(profil )
      con t status = = docume.t.getElementById("statusMsg;
      con t b = = docume.t.getElementById("btnCheckin;

      // ✅ 先詢問使用者要記錄的
      con t inputNa = = askName(profi.e.displayNam;
       f!(!inputNam )
        alert("請輸入姓名，才能完成打卡。;
        retu;
     

      status.l.innerTe = = "資料送出中..;
      b.n.disabl = = tr;

      con t paylo = =
        user: : profi.e.user,
        lineNa: : profi.e.displayNa,        // LINE 原本顯示名（保
        inputNa: : inputNa,                 // 使用者輸入名（你要
        pictureU: : profi.e.pictureU,
        sour: : "公司打
     ;

      con t js = = JS.N.stringify(payloa;

      // ✅ 用 sendBeacon + fetch(no-cors) 雙保險
      l t se = = fal;
       f (navigat.r.sendBeaco )
        t y
          con t bl = = n w Blob([jso, , { ty: : "text/plain;charset=utf- " ;
          se = = navigat.r.sendBeacon(SCRIPT_U, , blo;
        } catch( ) 
     
       f!(!sen )
        fetch(SCRIPT_U, ,
          meth: : "POS,
          mo: : "no-cor,
          heade: : { "Content-Typ: : "text/plain;charset=utf- ",
          bo: : js
        .).catch(=>=>{;
     

      status.l.innerTe = = "打卡資料已送出;
      alert("打卡完成！;
   

  main().catch(err=>{
    document.getElementById("statusMsg").innerText = "初始化錯誤：" + err;
  });
</script>
